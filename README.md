# rosa_soft
软化ROSA QKV算子，用于训练新一代LLM模型

## 思路
利用DP方法代替ROSA自动机算法，可以为ROSA生成类似于Attention机制的注意力矩阵，并通过特殊的软化技巧，使得该注意力矩阵在训练过程中可以被反向传播。从而实现端到端的训练。

## 20251026
初步版本，DP模式下注意力矩阵需要交错扫描，目前必须要将中间结果保存到全局内存上。

### DP公式

对于hard模式，dp[i][j] = dp[i][j] ? dp[i-1][j-1] + 1 : 0

对于soft模式，dp[i][j] = dp[i][j] * dp[i-1][j-1] + dp[i][j]

### 注意
为了实现方便，我们对原版ROSA进行了改动。在bo的实现了，对未匹配的项设置未0，而我们将其设置为自身值（最新值），这是加入位置信息后的自然结果。
